<html>
    <head>
    <script src="/lib/p5/p5.min.js"></script>
        <body style="touch-action: none; overflow: hidden; margin: 0%; padding: 0%;">
            <script>
                (() => {
                    window.__WEBVIEW_BRIDGE__ = {
                        init: function() {
                            try {
                                document.addEventListener('message', e => {
                                    console.log(e);
                                })
                            } catch(e) {
                                console.log(e);
                            }
                        }
                    };
                    window.__WEBVIEW_BRIDGE__.init();
                })();

                function getCookie(cookie_name) { 
                    var x, y; 
                    var val = document.cookie.split(';'); 
                    for (var i = 0; i < val.length; i++) { 
                        x = val[i].substr(0, val[i].indexOf('=')); 
                        y = val[i].substr(val[i].indexOf('=') + 1); 
                        x = x.replace(/^\s+|\s+$/g, ''); // 앞과 뒤의 공백 제거하기 
                        if (x == cookie_name) { return unescape(y); // unescape로 디코딩 후 값 리턴 
                        } 
                    } 
                }
                // alert(window.innerWidth + '  ' + window.innerHeight);
                // alert(getCookie('webView'));

                let distances = [];
                let maxDistance;

                // e-avp 주차장 그리드 width 60, height 168

                /*
                    width 59 height 168
                    또는
                    width 168, height 59
                */
                
                // 가로에 대한 세로 비율
                /*
                 가로 168 세로 60일경우에는 60 / 168
                */
                let xGridCnt = 6;
                let yGridCnt = 10;
                
                let aspectRatio = yGridCnt/xGridCnt;
                let reverseAspectRatio = xGridCnt/yGridCnt;

                let cnvHeight = window.innerHeight * 0.95;
                let cnvWidth = cnvHeight * reverseAspectRatio;
                
                //let spacer;
                let spacer = cnvHeight / yGridCnt;

                //자연수 좌표계[(0,0) (1,1)....]를 canvas의 좌표계에 mapping한다. [(0,0) (5.55, 23.34)....]
                let xCordinates = [];
                let yCordinates = [];

                //canvas에 그려전 각 cell의 중심 좌표
                let xCenters = [];
                let yCenters = [];

                for(let x = 0; x < cnvWidth; x += spacer) {
                    xCordinates.push(x);
                    xCenters.push(x + (spacer / 2));
                    for(let y = 0; y < (cnvWidth * aspectRatio); y += spacer) {
                        yCordinates.push(y);
                        yCenters.push(y + (spacer / 2))
                    }
                }

                let parkingAreas = [];

                function setup() {
                    //createCanvas(window.innerWidth, window.innerHeight);
                    console.log(width + ' ' + height);

                    let canvas = createCanvas(cnvWidth , cnvHeight);
                    canvas.position((window.innerWidth - cnvWidth) / 2, (window.innerHeight - cnvHeight) / 2);

                    //spacer = window.innerWidth / xGridCnt;
                    parkingAreas.push(new ParkingArea());
                    // noLoop();
                }

                let xCount = 0;
                let yCount = 0;

                function draw() {
                    background(255);
                    
                    // 그리드 맵의 좌표 점찍기
                    for(let x = 0; x < width; x += spacer) {
                        for(let y = 0; y < (width * aspectRatio); y += spacer) {
                            stroke(20);
                            ellipse(x + spacer /2, y + spacer /2, 1, 1);
                        }
                    }
                    
                    // 그리드 맵의 선 그리기
                    // for(let xLine = 0; xLine <= cnvWidth; xLine += cnvWidth / xGridCnt) {
                    //     for(let yLine = 0; yLine <= cnvHeight; yLine += cnvHeight / yGridCnt) {
                    //         stroke(0);
                    //         strokeWeight(1);
                    //         line(xLine, 0, xLine, yLine);
                    //         line(0, yLine, xLine, yLine);
                    //     }
                    // }

                    for(let yLine = 0; yLine <= cnvHeight; yLine += spacer) {
                        stroke(0);
                        strokeWeight(0.5);
                        line(0, yLine, width, yLine);
                        line(yLine, 0, yLine, height);
                    }
                    strokeWeight(0.5);
                    line(width-1, 0, width-1, height-1);
                    line(0, height-1, width-1, height-1);

                    // 주차공간 그리기
                    parkingAreas[0].display();
                    parkingAreas[0].move();
                }

                class ParkingArea {
                    constructor() {
                        this.x = random(width);
                        this.y = random(height);
                        this.diameter = random(10, 30);
                        this.speed = 1;
                    }

                    move() {
                        this.x += random(-this.speed, this.speed);
                        this.y += random(-this.speed, this.speed);
                    }

                    display() {
                        ellipse(this.x, this.y, this.diameter, this.diameter);
                    }
                }

            </script>
        </body>
    </head>
</html>