<html>
    <head>
    <script src="/lib/p5/p5.min.js"></script>
        <body style="touch-action: none; overflow: hidden; margin: 0%; padding: 0%;">
            <script>
                (() => {
                    window.__WEBVIEW_BRIDGE__ = {
                        init: function() {
                            try {
                                document.addEventListener('message', e => {
                                    console.log(e);
                                })
                            } catch(e) {
                                console.log(e);
                            }
                        }
                    };
                    window.__WEBVIEW_BRIDGE__.init();
                })();

                function getCookie(cookie_name) { 
                    var x, y; 
                    var val = document.cookie.split(';'); 
                    for (var i = 0; i < val.length; i++) { 
                        x = val[i].substr(0, val[i].indexOf('=')); 
                        y = val[i].substr(val[i].indexOf('=') + 1); 
                        x = x.replace(/^\s+|\s+$/g, ''); // 앞과 뒤의 공백 제거하기 
                        if (x == cookie_name) { return unescape(y); // unescape로 디코딩 후 값 리턴 
                        } 
                    } 
                }
                // alert(window.innerWidth + '  ' + window.innerHeight);
                // alert(getCookie('webView'));


                let distances = [];
                let maxDistance;
                


                // e-avp 주차장 그리드 width 60, height 168

                /*
                    width 60, height 168
                    또는
                    width 168, height 60
                */
                
                // 가로에 대한 세로 비율
                /*
                 가로 168 세로 60일경우에는 60 / 168
                */
                let xGridCnt = 168;
                let yGridCnt = 60;
                let aspectRatio = yGridCnt/xGridCnt;

                let cnvWidth = window.innerWidth * 0.95;
                let cnvHeight = cnvWidth * aspectRatio;
                //let spacer;
                let spacer = cnvWidth / xGridCnt;

                let parkingArea;

                function setup() {
                    //createCanvas(window.innerWidth, window.innerHeight);
                    console.log(width + ' ' + height);

                    let canvas = createCanvas(cnvWidth , cnvHeight);
                    canvas.position((window.innerWidth - cnvWidth) / 2, (window.innerHeight - cnvHeight) / 2);

                    //spacer = window.innerWidth / xGridCnt;
                    parkingArea = new ParkingArea();
                    // noLoop();
                }

                let xCount = 0;
                let yCount = 0;

                function draw() {
                    background(220);
                    
                    // 그리드 맵의 좌표 점찍기
                    for(let x = 0; x < width; x += spacer) {
                        console.log(xCount++);
                        for(let y = 0; y < (width * aspectRatio); y += spacer) {
                            stroke(255);
                            ellipse(x + spacer /2, y + spacer /2, 1, 1);
                            console.log(yCount++);
                        }
                    }
                    
                    // 그리드 맵의 선 그리기
                    // for(let xLine = 0; xLine <= cnvWidth; xLine += cnvWidth / xGridCnt) {
                    //     for(let yLine = 0; yLine <= cnvHeight; yLine += cnvHeight / yGridCnt) {
                    //         stroke(0);
                    //         strokeWeight(1);
                    //         line(xLine, 0, xLine, yLine);
                    //         line(0, yLine, xLine, yLine);
                    //     }
                    // }

                    for(let xLine = 0; xLine <= cnvWidth; xLine += spacer) {
                        stroke(0);
                        strokeWeight(1);
                        line(xLine, 0, xLine, height);
                        line(width, xLine, 0, xLine);
                    }
                    strokeWeight(4);
                    line(0, 0, width, 0);
                    line(0, 0, 0, height);
                    line(width, 0, width, height);
                    line(0, height, width, height);
                    // 주차공간 그리기
                    parkingArea.display();
                }

                class ParkingArea {
                    constructor() {
                        this.x = random(width);
                        this.y = random(height);
                        this.diameter = random(10, 30);
                        this.speed = 1;
                    }

                    move() {
                        this.x += random(-this.speed, this.speed);
                        this.y += random(-this.speed, this.speed);
                    }

                    display() {
                        ellipse(this.x, this.y, this.diameter, this.diameter);
                    }
                }

            </script>
        </body>
    </head>
</html>